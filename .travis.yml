language: node_js
node_js:
 - "10.5"

env:
  global:
    - CI=false

## Script to Install it
install:
 - npm install
  # Install any dependencies required for building your site here.
  # `awscli` is required for invalidation of CloudFront distributions.
 - npm install -g travis-ci-cloudfront-invalidation

## Script to build it
script:
 - npm run build

deploy:
  
  # Branch to deploy (on means don't trigger unless)
  on:
    branch: master
  provider: s3

  access_key_id: $AWS_ACCESS_KEY_ID
  secret_access_key: $AWS_SECRET_ACCESS_KEY
  # Name of s3 bucket
  bucket: s3-react-test-app

  #Don't delete after build
  skip_cleanup: true

  #Path to local dir for site
  local_dir: build

  # Set the cache-control header
  cache_control: "max-age=21600"

after_deploy:
  - travis-ci-cloudfront-invalidation -a $AWS_ACCESS_KEY -s $AWS_SECRET_KEY -c $CLOUDFRONT_DISTRIBUTION_ID -i '/*' -b $TRAVIS_BRANCH -p $TRAVIS_PULL_REQUEST